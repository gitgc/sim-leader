# Global options
{
	# Conditional HTTPS based on environment variable
	{$CADDY_HTTPS_MODE:auto_https on}

	# Email for Let's Encrypt (only used when HTTPS is enabled)
	email {$CADDY_EMAIL}

	# Use DigitalOcean DNS for ACME challenge (only used when HTTPS is enabled)
	{$CADDY_ACME_CONFIG:}
}

# Main site configuration
{$CADDY_SITE_ADDRESS:localhost} {
	# Reverse proxy to app for all requests
	reverse_proxy app:3001

	# Add cache headers for static assets
	@static path *.css *.js *.png *.jpg *.jpeg *.gif *.ico *.svg *.woff *.woff2 *.ttf *.eot
	header @static Cache-Control "public, max-age=86400"

	# Security headers
	header {
		# Remove server info
		-Server

		# Security headers
		X-Content-Type-Options nosniff
		X-Frame-Options DENY
		X-XSS-Protection "1; mode=block"
		Referrer-Policy strict-origin-when-cross-origin

		# HSTS (only for HTTPS)
		{$CADDY_HSTS_HEADER:}
	}

	# Enable gzip compression
	encode gzip

	# Logging
	log {
		output file /var/log/caddy/access.log
		format json
	}
}
